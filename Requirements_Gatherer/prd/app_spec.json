{
  "overview": {
    "purpose": "Minimal, local-first single-page app (SPA) for personal productivity — simple to-dos only. Desktop-first, installable as a PWA, offline-capable.",
    "notes": "Matches user requirement to keep the app minimal: one-line tasks (title only) and completed status. Data remains local to device and browser."
  },
  "functional_requirements": [
    {
      "id": "FR1",
      "title": "Create Task",
      "description": "User can create a new task by entering a title (required).",
      "validation": "Title required, trimmed, max 50 chars; reject empty or whitespace-only input; show inline validation and character counter.",
      "acceptance_criteria": [
        "Title input is visible and focused by default",
        "Submit on Enter clears input and returns focus",
        "Empty/whitespace-only rejected with inline error",
        "Titles > 50 chars rejected with helpful message"
      ]
    },
    {
      "id": "FR2",
      "title": "Toggle Complete",
      "description": "User can mark a task complete with a checkbox.",
      "acceptance_criteria": [
        "Toggle updates UI instantly and persists locally",
        "Completed tasks are visually distinct (strike-through or dimmed)"
      ]
    },
    {
      "id": "FR3",
      "title": "Edit Task",
      "description": "User can edit a task title inline.",
      "validation": "Same as create: required, max 50 chars.",
      "acceptance_criteria": ["Click/Enter to edit; validation applied on save"]
    },
    {
      "id": "FR4",
      "title": "Delete Task",
      "description": "User can delete a task. (Behavior needs confirmation: undo toast recommended.)",
      "acceptance_criteria": ["Single clear action to delete (trash icon or keyboard shortcut)"]
    },
    {
      "id": "FR5",
      "title": "Theme Toggle",
      "description": "Light/dark theme toggle with persistence across sessions.",
      "acceptance_criteria": ["Theme selection persists locally"]
    },
    {
      "id": "FR6",
      "title": "Installable PWA",
      "description": "App meets PWA installability criteria (manifest.json, service worker, secure context).",
      "acceptance_criteria": ["Installable on desktop; works offline after first load"]
    }
  ],
  "non_functional_requirements": {
    "performance": "App shell interactive < 1s on modern desktop browsers; operations perceived near-instant (<100ms). Target JS+CSS <= 150KB gzipped for MVP.",
    "offline_behavior": "Service Worker caches app shell; core features operate without network.",
    "accessibility": "Follow basic WCAG 2.1 AA where feasible: keyboard operability, focus outlines, color contrast. Slightly larger default text for readability.",
    "privacy_security": "No user data leaves device. Use secure contexts for PWA installability. No analytics in MVP."
  },
  "ui_ux_design": {
    "layout": "Header (title, theme toggle, install action) -> New Task input -> Task list -> Footer/Toast area.",
    "components": ["Header", "New Task Input (single-line, char counter)", "Task Item row (checkbox, title, edit, delete)", "Empty State"],
    "microcopy": {"add_placeholder": "Add a task…", "delete_label": "Delete", "undo": "Undo"}
  },
  "data_model": {
    "storage_choice_recommendation": "IndexedDB (recommended) via tiny wrapper (idb). localStorage acceptable for very small MVP but less robust.",
    "database": "todo_app_db",
    "object_store": "tasks",
    "schema": {
      "id": {"type": "string", "required": true, "notes": "UUID v4 or short unique string"},
      "title": {"type": "string", "required": true, "maxLength": 50},
      "completed": {"type": "boolean", "required": true, "default": false},
      "createdAt": {"type": "string", "format": "ISO8601", "internal": true},
      "updatedAt": {"type": "string", "format": "ISO8601", "internal": true}
    },
    "example": {"id":"3f8a9b2e-...","title":"Buy groceries","completed":false,"createdAt":"2025-09-03T12:00:00.000Z","updatedAt":"2025-09-03T12:00:00.000Z"}
  },
  "validation_and_edge_cases": {
    "title_validation": "Reject empty or whitespace-only; enforce max length 50; show remaining characters; block submission when invalid.",
    "empty_list": "Show friendly empty state with CTA.",
    "db_errors": "When IndexedDB unavailable or write fails, show clear error message with guidance (free up space or try another profile).",
    "delete_recovery": "Recommend undo toast (5s) — needs confirmation from user whether to include undo in MVP.",
    "concurrency": "Single-user single-tab primary assumption; basic cross-tab sync via BroadcastChannel or storage events where supported. Not a primary use case."
  },
  "storage_and_persistence": {
    "local_first": "All data stays in-browser (IndexedDB).",
    "service_worker": "Cache app shell; cache-first strategy for static assets; network fallback for updates.",
    "backups": "User opted out of backups for MVP — no export/import UI included. Developer note: provide optional JSON import/export in future."
  },
  "implementation_plan": {
    "tech_choices": {"framework":"Vanilla JavaScript (ES Modules) + Vite","ui":"Semantic HTML + CSS variables; optional tiny framework (preact/alpine) if desired","storage":"IndexedDB via idb wrapper","build":"Vite","lint":"ESLint + Prettier"},
    "folder_structure": ["/src","/src/assets","/src/css","/src/js","index.html","manifest.webmanifest","service-worker.js","/public"],
    "key_modules": ["store.js (IndexedDB wrapper)","ui.js (render & DOM)","main.js (bootstrap)","pwa.js (SW registration)","shortcuts.js (keyboard)","utils.js"],
    "api_surface": ["getAllTasks()","addTask(task)","updateTask(id,changes)","deleteTask(id)","setTheme(theme)","getTheme()"]
  },
  "qa_checklist": [
    "Core flows: create, edit, delete, toggle complete",
    "Title validation enforced",
    "Theme toggle persists",
    "PWA: manifest + service worker -> installable",
    "Offline: app shell loads and tasks editable offline",
    "Accessibility: keyboard, focus, contrast",
    "Error handling: DB/unavailable/quota errors surfaced",
    "Edge cases: empty list, rapid ops, long typing",
    "Cross-tab: basic behavior verified"
  ],
  "success_criteria": [
    "Users can add/edit/delete/toggle tasks per rules",
    "App is installable on desktop and works offline",
    "Data persists across reloads and restarts in same browser profile",
    "No critical data-loss bugs in normal usage"
  ],
  "future_enhancements": ["Import/Export (JSON)","Optional cloud sync (opt-in)","Search, tags, priorities, due dates, reminders","Archive & bulk actions"],
  "review_summary": {
    "requirements_covered": true,
    "terminology_consistency": "Mostly consistent. Docs use both 'task' and 'to-do' interchangeably; recommend standardizing to 'task' across implementation and UI.",
    "required_plan_sections_present": true,
    "notes": "The plan.md covers all user requirements and includes recommended implementation details. Internal metadata (createdAt/updatedAt) are included as internal-only, matching the user's allowance for internal IDs/timestamps. The plan adds reasonable developer recommendations (IndexedDB, undo toast) that do not contradict the user's minimal spec.",
    "approved_for_build": false,
    "pending_clarifications": [
      {
        "id": "Q1",
        "question": "Delete behavior: do you want a delete action in the MVP? If yes, do you want an undo toast (recommended)? If no delete action, should users only mark tasks completed?"
      },
      {
        "id": "Q2",
        "question": "Keyboard shortcuts: the plan proposes supporting shortcuts (e.g., 'N' or Ctrl/Cmd+N to create a new task, Enter to submit, 'E' to edit, 'Del' to delete). Do you want to confirm these defaults or provide preferred keybindings?"
      },
      {
        "id": "Q3",
        "question": "Storage choice: plan recommends IndexedDB for reliability. Do you prefer IndexedDB (recommended) or a simpler localStorage implementation for MVP?"
      },
      {
        "id": "Q4",
        "question": "Theme persistence: plan stores theme preference in localStorage. Is this acceptable?"
      }
    ]
  }
}
